{%- comment -%}
  Works recurssively

  Builds up base_url by appending page names up until current hierarchy:

base_url -> is current page.url
  level0   -> base_url/level0 (is being called by base_url)
  - level00   -> base_url/level0/level00  (is being called by level0)
  level1    -> base_url/level1

  include.hierarchy and pages are taken from parent element
{%- endcomment -%}

{% assign url_parts = page.url | split: '/' %}
{% assign url_parts_size = url_parts | size | minus: 1 %}
{% assign base_url = url_parts[0] | append: '/'%}
{% for i in (1..include.hierarchy) %}
  {% assign base_url = base_url | append: url_parts[i] | append: '/' %}
{% endfor %}

{%- comment -%}
  Get Child Pages for current URL from docs folder via url
{%- endcomment -%}

{% assign child_pages = include.pages | where_exp: "item", "item.url contains base_url" | sort:"nav_order"%}
{% assign current_hierarchy = include.hierarchy | plus: 1 %}
{% if current_hierarchy <= url_parts_size %}
  {% assign base_url_children = base_url | append: url_parts[current_hierarchy] | append: '/' %}
{% endif %}
<ul class="navigation-list">
{% for node in child_pages %}
  {% assign node_url_parts = node.url | split: '/' %}
  {% assign node_url_parts_size = node_url_parts | size | minus: 1 %}
  {% if node_url_parts_size == current_hierarchy %}
    {% assign active_path = false %}
    {% assign show_children = false %}
    {% if page.url == node.url %} 
      {% assign active_path = true %}
    {% endif %}
    {% if current_hierarchy <= url_parts_size %}
      {% if node.url contains base_url_children %}
        {% assign active_path = true %}
        {% assign show_children = true %}
      {% endif %}
    {% endif %}
    <li class="navigation-list-item {% if active_path == true %}active{% endif %}">
      <a href='{{node.url | absolute_url }}' class="navigation-list-link {% if active_path == true %}active{% endif %}">{{node.title}}</a>
      {% if show_children == true %}
        {% include nav.html pages=child_pages hierarchy=current_hierarchy %}
        {% assign current_hierarchy = current_hierarchy | minus: 1 %}
      {% endif %}
    </li>
  {% endif %}
{% endfor %}
</ul>
 